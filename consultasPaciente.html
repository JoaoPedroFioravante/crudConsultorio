<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Consultas Paciente</title>
</head>

<body>
    <h1>Consultas Paciente</h1>
    <form id="consultasPacienteX">
        <p>digite o id do paciente que deseja ver as consultas</p>
        <input type="text" id="idPaciente" required>
        <button>enviar</button>
    </form>
    <div id="listaConsultas"></div>
    <script>
        let form = document.querySelector("#consultasPacienteX");
        form.addEventListener("submit", consultasPaciente);
        async function consultasPaciente(e) {
            e.preventDefault();
            let div = document.querySelector("#listaConsultas");
            div.innerText = " ";
            let idPacient = document.querySelector("#idPaciente").value;
            try {
                let retorno = await fetch("https://ifsp.ddns.net/webservices/clinicaMedica/consultas");
                if (!retorno.ok) {
                    throw new Error("não foi possivel receber as consultas");
                }
                retorno = await retorno.json();
                retorno = retorno.filter((consulta) => (consulta.idPaciente == idPacient));
                if (retorno.length > 0) {
                    try {
                        listaMedicos = await fetch("https://ifsp.ddns.net/webservices/clinicaMedica/medicos");
                        if (!listaMedicos.ok) {
                            throw new Error("não foi possivel receber os dados dos medicos");
                        }
                        listaMedicos = await listaMedicos.json();
                        let tabela = document.createElement("table");
                        let thead = document.createElement("thead");
                        let tr = document.createElement("tr");
                        let th = document.createElement("th");
                        let th1 = document.createElement("th");
                        let th2 = document.createElement("th");
                        th.innerText = "Data";
                        th1.innerText = "Nome médico";
                        th2.innerText = "Id consulta";
                        tr.append(th);
                        tr.append(th1);
                        tr.append(th2);
                        thead.append(tr);
                        tabela.append(thead);
                        let tbody = document.createElement("tbody");
                        for (let consulta of retorno) {
                            let trx = document.createElement("tr");
                            let data = document.createElement("th");
                            let nomeMedico = document.createElement("td");
                            let id = document.createElement("td");
                            data.innerText = consulta.data
                            let idMedico = consulta.idMedico;
                            let nome = listaMedicos.filter((medicos) => (idMedico == medicos.id))
                            nome = nome[0].nome;
                            nomeMedico.innerText = nome;
                            id.innerText = consulta.id;
                            trx.append(data);
                            trx.append(nomeMedico);
                            trx.append(id);
                            tbody.append(trx);
                        }
                        tabela.append(tbody);
                        div.append(tabela);
                    }
                    catch (error) {
                        console.log(error.message)
                    }
                }
                else {
                    alert("não existem consultas para esse paciente");
                }
            }
            catch (error) {
                console.log(error);
            }
            finally {
                form.reset();
            }
        }
    </script>
</body>

</html>