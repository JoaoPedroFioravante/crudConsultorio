<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Listar Medicos</title>
</head>

<body>
    <h1>Médicos Cadastrados</h1>
    <div id="listaMedicos"></div><!-- medicos cadastrados irão estar dentro da div que estará nessa div-->
    <script>
        carregarDados();
        async function carregarDados() {
            try {
                let retorno = await fetch("https://ifsp.ddns.net/webservices/clinicaMedica/medicos");
                if (!retorno.ok) {
                    throw new Error("falha na requisição");
                }
                retorno = await retorno.json();
                let div = document.querySelector("#listaMedicos");
                let tabela = document.createElement("table");
                let thead = document.createElement("thead");
                let tr = document.createElement("tr");
                let th = document.createElement("th");
                let th1 = document.createElement("th");
                let th2 = document.createElement("th");
                let th3 = document.createElement("th");
                th.innerText = "ID médico";
                th1.innerText = "nome médico";
                th2.innerText = "especialidade";
                th3.innerText = "data de Cadastro";
                tr.append(th);
                tr.append(th1);
                tr.append(th2);
                tr.append(th3);
                thead.append(tr);
                tabela.append(thead);
                let tbody = document.createElement("tbody");
                for (let i = 0; i < retorno.length; i++) {
                    let listaEspecialidade = await especialidades();
                    let trx = document.createElement("tr");
                    let nome = document.createElement("td");
                    let especialidade = document.createElement("td");
                    let id = document.createElement("th");
                    let dataCadastro = document.createElement("td");
                    nome.innerText = retorno[i].nome;
                    let especialidadeNome = listaEspecialidade.filter((especialidade) => (retorno[i].idEspecialidade == especialidade.id))
                    especialidadeNome = especialidadeNome[0].nome;
                    especialidade.innerText = especialidadeNome;
                    id.innerText = retorno[i].id;
                    dataCadastro.innerText = retorno[i].dataCadastro;
                    trx.append(id);
                    trx.append(nome);
                    trx.append(especialidade);
                    trx.append(dataCadastro);
                    tbody.append(trx);
                }
                tabela.append(tbody);
                div.append(tabela);

            }
            catch (error) {
                console.log(error.message);
            }
        }
        async function especialidades() {
            try {
                let especialidade = await fetch("https://ifsp.ddns.net/webservices/clinicaMedica/especialidades");
                if (!especialidade.ok) {
                    throw new Error("não foi possivel obter especialidades");
                }
                especialidade = await especialidade.json();
                return especialidade;
            }
            catch (error) {
                console.log(error.message);
            }
        }
    </script>
</body>

</html>