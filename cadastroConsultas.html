<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cadastro Consultas</title>
</head>
<body>
    <h1>Cadastro Consultas</h1>
    <form id="cadastroConsultas">
        <p>digite o id do paciente</p>
        <input type="text" id="idPaciente" required>
        <p>digite o id do medico</p>
        <input type="text" id="idMedico" required>
        <p>digite a data da consulta</p>
        <input type="date" id="dataConsulta" required>
        <p>digite o horario da consulta</p>
        <input type="time" step="1" id="horarioConsulta" required>
        <br>
        <button>enviar</button>
    </form>
    <script>
        limitaData();
        let form = document.querySelector("#cadastroConsultas");
        form.addEventListener("submit", cadastroConsultas);
        async function cadastroConsultas(e) {
            e.preventDefault();
            let idPaciente = document.querySelector("#idPaciente").value;
            let idMedico = document.querySelector("#idMedico").value;
            let dataConsulta = document.querySelector("#dataConsulta").value;
            let horarioConsulta = document.querySelector("#horarioConsulta").value;
            let data = `${dataConsulta} ${horarioConsulta}`;
            let optionsPost = {
                method : "POST",
                body : JSON.stringify({
                    "idPaciente":idPaciente,
                    "idMedico": idMedico,
                    "data": data
                }),
                headers:{
                    "Content-type": "application/json"
                }
                
            }
            try{
                let retorno = await fetch("https://ifsp.ddns.net/webservices/clinicaMedica/consultas", optionsPost);
                if(!retorno.ok){
                    throw new Error("falhar ao cadastrar consulta");
                }
                console.log("consulta criada com sucesso");
            }
            catch(error){
                console.log(error.message);
            }
            finally{
                form.reset();
            }
        }


        function limitaData() {
            let hoje = new Date()
            hoje.setDate(hoje.getDate() + 1);
            let diaAtual = hoje.getDate();
            let mesAtual = hoje.getMonth() + 1;
            if (diaAtual < 10) {
                diaAtual = `0${diaAtual}`;
            }
            if (mesAtual < 10) {
                mesAtual = `0${mesAtual}`;
            }
            let anoAtual = hoje.getFullYear();
            let data = `${anoAtual}-${mesAtual}-${diaAtual}`;
            let date = document.querySelector("#dataConsulta");
            date.setAttribute("min", data);
        }
    </script>
</body>
</html>